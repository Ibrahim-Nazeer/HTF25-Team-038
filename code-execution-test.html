<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Execution Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        pre {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .error {
            color: #f44336;
        }
        .success {
            color: #4CAF50;
        }
    </style>
</head>
<body>
    <h1>ðŸ§ª Code Execution Test</h1>
    <p>Test if the Piston API can execute code in different languages</p>

    <div class="test-section">
        <h2>Test 1: JavaScript - Two Sum</h2>
        <button onclick="testJavaScript()">Run JavaScript Test</button>
        <pre id="js-output">Click button to test...</pre>
    </div>

    <div class="test-section">
        <h2>Test 2: Python - Two Sum</h2>
        <button onclick="testPython()">Run Python Test</button>
        <pre id="py-output">Click button to test...</pre>
    </div>

    <div class="test-section">
        <h2>Test 3: Simple JavaScript Output</h2>
        <button onclick="testSimpleJS()">Run Simple Test</button>
        <pre id="simple-output">Click button to test...</pre>
    </div>

    <script>
        async function testJavaScript() {
            const output = document.getElementById('js-output');
            output.textContent = 'Running...';

            const code = `function twoSum(nums, target) {
    const map = new Map();
    for (let i = 0; i < nums.length; i++) {
        const complement = target - nums[i];
        if (map.has(complement)) {
            return [map.get(complement), i];
        }
        map.set(nums[i], i);
    }
    return [];
}

// Test
const result = twoSum([2, 7, 11, 15], 9);
console.log(JSON.stringify(result));`;

            try {
                const response = await fetch('https://emkc.org/api/v2/piston/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        language: 'javascript',
                        version: '*',
                        files: [{ content: code }]
                    })
                });

                const result = await response.json();
                
                if (result.run) {
                    const stdout = result.run.stdout || '';
                    const stderr = result.run.stderr || '';
                    
                    if (stderr) {
                        output.innerHTML = `<span class="error">Error: ${stderr}</span>`;
                    } else {
                        const parsedResult = JSON.parse(stdout.trim());
                        const expected = [0, 1];
                        const passed = JSON.stringify(parsedResult) === JSON.stringify(expected);
                        
                        output.innerHTML = `<span class="${passed ? 'success' : 'error'}">
${passed ? 'âœ“ PASSED' : 'âœ— FAILED'}
Output: ${stdout}
Expected: [0, 1]
Got: ${JSON.stringify(parsedResult)}
</span>`;
                    }
                } else {
                    output.innerHTML = '<span class="error">Execution failed</span>';
                }
            } catch (error) {
                output.innerHTML = `<span class="error">Error: ${error.message}</span>`;
            }
        }

        async function testPython() {
            const output = document.getElementById('py-output');
            output.textContent = 'Running...';

            const code = `def twoSum(nums, target):
    num_map = {}
    for i, num in enumerate(nums):
        complement = target - num
        if complement in num_map:
            return [num_map[complement], i]
        num_map[num] = i
    return []

# Test
import json
result = twoSum([2, 7, 11, 15], 9)
print(json.dumps(result))`;

            try {
                const response = await fetch('https://emkc.org/api/v2/piston/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        language: 'python',
                        version: '*',
                        files: [{ content: code }]
                    })
                });

                const result = await response.json();
                
                if (result.run) {
                    const stdout = result.run.stdout || '';
                    const stderr = result.run.stderr || '';
                    
                    if (stderr) {
                        output.innerHTML = `<span class="error">Error: ${stderr}</span>`;
                    } else {
                        const parsedResult = JSON.parse(stdout.trim());
                        const expected = [0, 1];
                        const passed = JSON.stringify(parsedResult) === JSON.stringify(expected);
                        
                        output.innerHTML = `<span class="${passed ? 'success' : 'error'}">
${passed ? 'âœ“ PASSED' : 'âœ— FAILED'}
Output: ${stdout}
Expected: [0, 1]
Got: ${JSON.stringify(parsedResult)}
</span>`;
                    }
                } else {
                    output.innerHTML = '<span class="error">Execution failed</span>';
                }
            } catch (error) {
                output.innerHTML = `<span class="error">Error: ${error.message}</span>`;
            }
        }

        async function testSimpleJS() {
            const output = document.getElementById('simple-output');
            output.textContent = 'Running...';

            const code = `console.log("Hello from Piston API!");
console.log("2 + 2 =", 2 + 2);
console.log("Array:", [1, 2, 3, 4, 5]);`;

            try {
                const response = await fetch('https://emkc.org/api/v2/piston/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        language: 'javascript',
                        version: '*',
                        files: [{ content: code }]
                    })
                });

                const result = await response.json();
                
                if (result.run) {
                    const stdout = result.run.stdout || '';
                    const stderr = result.run.stderr || '';
                    
                    if (stderr) {
                        output.innerHTML = `<span class="error">Error: ${stderr}</span>`;
                    } else {
                        output.innerHTML = `<span class="success">âœ“ SUCCESS\n${stdout}</span>`;
                    }
                } else {
                    output.innerHTML = '<span class="error">Execution failed</span>';
                }
            } catch (error) {
                output.innerHTML = `<span class="error">Error: ${error.message}</span>`;
            }
        }
    </script>
</body>
</html>
